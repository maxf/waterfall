<!DOCTYPE html>
<html>
  <head>
    <style>
     html {
       font-family: helvetica;
       background: #000;
     }
     body {
       margin: 0;
     }
     table {
       border-collapse: collapse;
       width: 100%;
     }
     td {
       border: 1px solid black;
       width: 1.3em;
       height: 1.3em;
       text-align: center;
       cursor: pointer;
     }
     td.even {
       background: #fcf;
     }
     td.today {
       outline: 5px solid red;
     }
     .outer {
       height: 100vh;
     }
     .year-buttons {
       width: 100%;
     }
     .error {
       position: fixed;
       background: #555;
       color: white;
       font-size: 200%;
       font-weight: bold;
       padding: 1em;
       margin: 1em;
     }
     .columns {
       display: flex;
       height: 100vh;
     }
     .calendar {
       background: white;
       width: 13em;
       overflow: auto;
       max-height: 100vh;
       padding: 1em;
     }
     .year-buttons {
       margin: .5em 0;
       text-align: center;
     }
     .prev-next-buttons {
       text-align: center;
     }
     #photos {
       margin: 1em;
       flex: 1;
       overflow-y: scroll;
       max-height: 100vh;
       color: white;
     }
     #photos ul {
       padding: 0;
       text-align: center;
     }
     #photos li {
       list-style-type: none;
       margin-bottom: 3em;
     }
     #photos li div { text-align: left }
     #photos img {
       max-width: 100%;
       max-height: 100vh;
     }
    </style>
  </head>
  <body>
    <div id="main">
    </div>
    <script>
     const files = window.require('./files');
     const Elm = window.require('./elm');
     const node = document.getElementById('main');
     const app = Elm.Main.embed(node);
     const {remote} = require('electron')
     const {dialog} = remote

     app.ports.deletePhoto.subscribe(args => {
       const fileDir = args[0];
       const fileName = args[1];
       const success = files.deleteFile(fileDir, fileName)
       const result = success ? [fileDir, fileName] : ['', ''];
       app.ports.deletePhotoResult.send(result);
     });
     app.ports.scanPhotos.subscribe(dir => {
       files.scanPhotos(dir, metadataList => {
         app.ports.scanPhotosResult.send(metadataList);
       })
     });
     app.ports.requestPhotoDir.subscribe(() => {
       const dir = files.requestPhotoDir();
       app.ports.requestPhotoDirResult.send(dir);
     });
     app.ports.saveModel.subscribe(model => {
       files.saveModel(model, err => {
         app.ports.saveModelResult.send(!err);
       })
     });
     app.ports.loadModel.subscribe(() => {
       files.loadModel((err, data) => {
         app.ports.loadModelResult.send(err ? "" : data.toString());
       })
     });



     let closeWindow = false

     window.addEventListener('beforeunload', evt => {
       if (closeWindow) return;
       evt.returnValue = false;
       // save the model (even if user doesn't quit
       app.ports.applicationQuitting.send("save model now");
       setTimeout(() => {
         let result = dialog.showMessageBox({
           message: 'Quit app?',
           buttons: ['Yes', 'No']
         });
         if (result == 0) {
           closeWindow = true
           remote.getCurrentWindow().close();
         }
       })
     })

    </script>
  </body>
</html>
