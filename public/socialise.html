<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="main.css"/>
  </head>
  <body>
    <div id="main"></div>
    <script src="socialise.js"></script>
    <script>
     var node = document.getElementById('main');
     var app = Elm.Main.embed(node);
     var localStorage = window.localStorage;

     app.ports.localStorageSetItem.subscribe(function(keyValuePair) {
       if (keyValuePair.length !== 2) {
         console.log("bad value passed to localStorageSetItem port", key)
       } else {
         localStorage.setItem(keyValuePair[0], keyValuePair[1]);
       }
     });

     app.ports.localStorageRemoveItem.subscribe(function(keyName) {
       localStorage.removeItem(keyName);
     });

     app.ports.localStorageGetItem.subscribe(function(keyName) {
       var value = localStorage.getItem(keyName);
       app.ports.localStorageRetrievedItem.send([keyName, value]);
     });

     app.ports.fileSelected.subscribe(function (id) {
       var node = document.getElementById(id);
       if (node === null) {
         return;
       }

       // If your file upload field allows multiple files, you might
       // want to consider turning this into a `for` loop.
       var file = node.files[0];
       var reader = new FileReader();

       // FileReader API is event based. Once a file is selected
       // it fires events. We hook into the `onload` event for our reader.
       reader.onload = (function(event) {
         // The event carries the `target`. The `target` is the file
         // that was selected. The result is base64 encoded contents of the file.
         var base64encoded = event.target.result;
         // We build up the `ImagePortData` object here that will be passed to our Elm
         // runtime through the `fileContentRead` subscription.
         var portData = {
           contents: base64encoded,
           filename: file.name
         };

         // We call the `fileContentRead` port with the file data
         // which will be sent to our Elm runtime via Subscriptions.
         app.ports.fileContentRead.send(portData);
       });

       // Connect our FileReader with the file that was selected in our `input` node.
       reader.readAsDataURL(file);
     });

    </script>
  </body>
</html>
